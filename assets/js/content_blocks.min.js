/*! Curatable Content Blocks - v0.1.0
 * http://10up.com/
 * Copyright (c) 2014; * Licensed GPLv2+ */
var wp=window.wp||{};(function(e){"use strict";function t(t){t.preventDefault();var n,c=e(".ccb-add"),l=e(t.currentTarget),r=l.data("type"),i=o.find(".row").last().index();n=r in a?a[r]:a[r]=e("#tmpl-ccb-cb-"+r).html(),n=n.replace(/\{\{\{row\}\}\}/g,++i),c.before(n)}function n(t){t.preventDefault();var n=e(t.currentTarget);n.closest(".row").remove(),e("[name^='ccb_content_blocks[']").each(function(){var t=e(this),n=t.parents(".row").index(),c=t.attr("name"),o=c.replace(/ccb_content_blocks\[[0-9]+\]/,"ccb_content_blocks["+n+"]");t.attr("name",o)})}var c,o=e("body");e(".sortable").sortable({handle:".handle",forcePlaceholderSize:!0,items:"> div",update:function(t){var n=e(t.target);n.hasClass("content-blocks-wrapper")&&e("[name^='ccb_content_blocks[']").each(function(){var t=e(this),n=t.parents(".row").index(),c=t.attr("name"),o=c.replace(/ccb_content_blocks\[[0-9]+\]/,"ccb_content_blocks["+n+"]");t.attr("name",o)})}}),o.on("click",".content-block-adder .toggle",function(t){t.preventDefault(),e(this).toggleClass("open").siblings(".content-block-select").slideToggle("fast")});var a={};o.on("click",".add-content-block",function(t){var n,c=e(this),o=c.closest(".content-block-adder"),l=o.data("ccbArea"),r=c.parents(".row").index(),i=c.parents(".block").data("ccbColumn"),s=o.data("ccbIterator"),g=o.find(".toggle"),d=c.siblings("[name=new_content_block]").val();n=d in a?a[d]:a[d]=e("#tmpl-ccb-cb-"+d).html(),n=n.replace(/\{\{\{area\}\}\}/g,l),n=n.replace(/\{\{\{row\}\}\}/g,r),n=n.replace(/\{\{\{column\}\}\}/g,i),n=n.replace(/\{\{\{iterator\}\}\}/g,s),o.data("ccbIterator",s+1);var b=e(n).insertBefore(o);if("embeds"===d){var u=b.find(".wp-editor-area").attr("id");quicktags(u)}g.click(),t.preventDefault()}),o.on("click",".content-block-header",function(){e(this).parent(".content-block").toggleClass("collapsed")}),o.on("click",".delete-content-block",function(t){e(this).closest(".content-block").remove(),t.preventDefault()}),o.on("click",".delete-row",function(t){e(this).closest(".row").remove(),t.preventDefault(),e("[name^='ccb_content_blocks[']").each(function(){var t=e(this),n=t.parents(".row").index(),c=t.attr("name"),o=c.replace(/ccb_content_blocks\[[0-9]+\]/,"ccb_content_blocks["+n+"]");t.attr("name",o)})}),o.on("change",".toggle-manual input",function(t){t.preventDefault();var n=e(this),c=n.closest(".toggle-manual");c.siblings(".non-manual").slideToggle("fast"),c.siblings(".manual").slideToggle("fast")}),o.on("click",".select-image",function(t){var n=e(this),o=n.siblings("img"),a=n.siblings(".image-id-input");return t.preventDefault(),c?(c.open(),void 0):(c=wp.media.frames.chooseImage=wp.media({title:"Choose an Image",library:{type:"image"},button:{text:"Select Image"}}),c.on("select",function(){var e=c.state().get("selection").first(),t=e.get("sizes"),n=e.get("url");t.thumbnail!==void 0&&(n=t.thumbnail.url),a.attr("value",e.id),o.attr("src",n)}),c.open(),void 0)}),o.on("click",".remove-image",function(t){var n=e(this),c=n.siblings("img"),o=n.siblings(".image-id-input");t.preventDefault(),c.attr("src",""),o.attr("value","")}),e(".ccb-choose-row a").on("click",t),e(".delete-row").on("click",n);var l=e(".content-blocks-wrapper"),r=document.getElementById("postdivrich"),i={init:function(){var t=e(document.getElementById("ccb-curated-page"));t.prop("checked")&&i.show(),e(document.getElementById("ccb-curated-page")).on("click",i.toggle)},show:function(){l.show(),e(r).hide()},toggle:function(){l.toggle(),e(r).toggle()}};e(document).ready(i.init)})(jQuery);